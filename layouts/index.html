{{ define "main" }}
  <h1 class="visually-hidden">{{ .Title }}</h1>
  <ul class="PostList grid">
    {{ $paginator := .Paginate (where .Site.RegularPages "Type" "post") 40 }}
    {{ range $paginator.Pages }}
      <li class="PostList-item">

        {{ $image_alt := .Params.image_alt }}
        
        {{ if isset .Params "image" }}
          
          {{ $image := .Params.image }}
          {{ $image_ratio := .Params.image_ratio }}
          {{ $cloudinary_url := .Site.Params.cloudinary_url }}
          {{ $base := "/images/" }}
          {{ if hugo.IsServer }}
            {{ $base = $cloudinary_url }}
          {{ end }}

          <picture class="{{- with $image_ratio -}}aspect-ratio-{{ . }}{{- end -}}">
            {{ with $image }}
              <source 
                type="image/avif" 
                sizes="(min-width: 768px) 25vw, 100vw"
                srcset="{{ $base }}f_avif/q_60/w_256/{{ . | replaceRE ".jpg|.jpeg|.JPG|.png|.PNG" ".avif" }} 256w,
                        {{ $base }}f_avif/q_60/w_512/{{ . | replaceRE ".jpg|.jpeg|.JPG|.png|.PNG" ".avif" }} 512w,
                        {{ $base }}f_avif/q_60/w_768/{{ . | replaceRE ".jpg|.jpeg|.JPG|.png|.PNG" ".avif" }} 768w"
              />
              <source 
                type="image/webp" 
                sizes="(min-width: 768px) 25vw, 100vw"
                srcset="{{ $base }}f_webp/q_60/w_256/{{ . | replaceRE ".jpg|.jpeg|.JPG|.png|.PNG" ".webp" }} 256w,
                        {{ $base }}f_webp/q_60/w_512/{{ . | replaceRE ".jpg|.jpeg|.JPG|.png|.PNG" ".webp" }} 512w,
                        {{ $base }}f_webp/q_60/w_768/{{ . | replaceRE ".jpg|.jpeg|.JPG|.png|.PNG" ".webp" }} 768w"
              />
              <source 
                type="image/jpeg" 
                sizes="(min-width: 768px) 25vw, 100vw"
                srcset="{{ $base }}f_auto/q_60/w_256/{{ . | replaceRE ".jpeg|.JPG|.png|.PNG" ".jpg" }} 256w,
                        {{ $base }}f_auto/q_60/w_512/{{ . | replaceRE ".jpeg|.JPG|.png|.PNG" ".jpg" }} 512w,
                        {{ $base }}f_auto/q_60/w_768/{{ . | replaceRE ".jpeg|.JPG|.png|.PNG" ".jpg" }} 768w"
              />
              <img
                src="{{ $base }}f_auto/q_60/w_512/{{ . }}"
                {{ with $image_alt }}
                  alt="{{ . }}"
                {{ else }}
                  alt=""
                {{ end }} 
                loading="lazy"
                decoding="async"
                style="background-size: cover; background-image: url('{{ $base }}f_auto/q_1/w_5/{{ . }}'); width: 100%;
                height: 100%;" 
                {{ if (eq $image_ratio "square") }}
                  width="1000"
                  height="1000"
                {{ else if (eq $image_ratio "landscape") }}
                  width="100%"
                  height="853"
                {{ else if (eq $image_ratio "portrait") }}
                  width="960"
                  height="1280"
                {{ end }}
              />
            {{ end }}
          </picture>
        {{ else }}

          {{ with .Resources.GetMatch "{*.*,*.jpg,*.png,*.jpeg,*.webp,*.avif,*.gif}" }}
            {{- $src := . -}}
            {{- $pageDir := .File.Dir -}}
            {{- $name := $src.Name -}}
            {{- $baseName := replaceRE "\\.[^.]+$" "" $name -}}
            {{- $slug := urlize $baseName -}}
            {{- $image := printf "tomas-master/visual-garden/%s%s.jpg" $pageDir $slug -}}
            {{- $image_ratio := $.Params.image_ratio -}}
            {{- $cloudinary_url := $.Site.Params.cloudinary_url -}}
            {{- $base := "/images/" -}}
            {{- if hugo.IsServer -}}
              {{- $base = $cloudinary_url -}}
            {{- end -}}

            <picture class="{{- with $image_ratio -}}aspect-ratio-{{ . }}{{- end -}}">
              {{ with $image }}
                <source 
                  type="image/avif" 
                  sizes="(min-width: 768px) 25vw, 100vw"
                  srcset="{{ $base }}f_avif/q_60/w_256/{{ . | replaceRE ".jpg|.jpeg|.JPG|.png|.PNG" ".avif" }} 256w,
                          {{ $base }}f_avif/q_60/w_512/{{ . | replaceRE ".jpg|.jpeg|.JPG|.png|.PNG" ".avif" }} 512w,
                          {{ $base }}f_avif/q_60/w_768/{{ . | replaceRE ".jpg|.jpeg|.JPG|.png|.PNG" ".avif" }} 768w"
                />
                <source 
                  type="image/webp" 
                  sizes="(min-width: 768px) 25vw, 100vw"
                  srcset="{{ $base }}f_webp/q_60/w_256/{{ . | replaceRE ".jpg|.jpeg|.JPG|.png|.PNG" ".webp" }} 256w,
                          {{ $base }}f_webp/q_60/w_512/{{ . | replaceRE ".jpg|.jpeg|.JPG|.png|.PNG" ".webp" }} 512w,
                          {{ $base }}f_webp/q_60/w_768/{{ . | replaceRE ".jpg|.jpeg|.JPG|.png|.PNG" ".webp" }} 768w"
                />
                <source 
                  type="image/jpeg" 
                  sizes="(min-width: 768px) 25vw, 100vw"
                  srcset="{{ $base }}f_auto/q_60/w_256/{{ . | replaceRE ".jpeg|.JPG|.png|.PNG" ".jpg" }} 256w,
                          {{ $base }}f_auto/q_60/w_512/{{ . | replaceRE ".jpeg|.JPG|.png|.PNG" ".jpg" }} 512w,
                          {{ $base }}f_auto/q_60/w_768/{{ . | replaceRE ".jpeg|.JPG|.png|.PNG" ".jpg" }} 768w"
                />
                <img
                  src="{{ $base }}f_auto/q_60/w_512/{{ . }}"
                  {{ with $image_alt }}
                    alt="{{ . }}"
                  {{ else }}
                    alt=""
                  {{ end }} 
                  loading="lazy"
                  decoding="async"
                  style="background-size: cover; background-image: url('{{ $base }}f_auto/q_1/w_5/{{ . }}'); width: 100%;
                  height: 100%;" 
                  {{ if (eq $image_ratio "square") }}
                    width="1000"
                    height="1000"
                  {{ else if (eq $image_ratio "landscape") }}
                    width="100%"
                    height="853"
                  {{ else if (eq $image_ratio "portrait") }}
                    width="960"
                    height="1280"
                  {{ end }}
                />
              {{ end }}
            </picture>
          {{ end }}

        {{ end }}
        
        <h2 class="PostList-itemTitle">
          <a class="PostList-itemLink" href="{{ .Permalink }}">{{ .Title }}</a>
        </h2>
      </li>
    {{ end }}
  </ul>
{{ partial "pagination.html" . }}
{{ end }}
{{ define "footer" }}
  {{ if ne .Layout "lightbox" }}
      {{- partialCached "footer.html" . -}}
  {{ end }}
{{ end }}


